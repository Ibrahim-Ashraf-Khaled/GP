# ğŸ”„ Gamasa Properties - Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ­Ø¯ ÙˆØ§Ù„Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø©

## ğŸ“‹ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠØ¯Ù…Ø¬ Ù†ØªØ§Ø¦Ø¬ ØªØ­Ù„ÙŠÙ„ÙŠÙ† ØªÙ‚Ù†ÙŠÙŠÙ† Ø´Ø§Ù…Ù„ÙŠÙ† Ù„Ù„Ù…Ø´Ø±ÙˆØ¹:
- **Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„:** Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ø¹Ù…Ø§Ø±ÙŠØ© ÙˆØªÙ‚Ù†ÙŠØ© ØªÙØµÙŠÙ„ÙŠØ© (ÙØ¨Ø±Ø§ÙŠØ± 7ØŒ 2026)
- **Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ:** Ù…Ø±Ø§Ø¬Ø¹Ø© OpenCode.ai Ø§Ù„ÙÙ†ÙŠØ© (ÙØ¨Ø±Ø§ÙŠØ± 8ØŒ 2026)

**Ø§Ù„Ù‡Ø¯Ù:** Ø±Ø¤ÙŠØ© Ù…ÙˆØ­Ø¯Ø© ÙˆØ§Ø¶Ø­Ø© + Ø®Ø·Ø© ØªÙ†ÙÙŠØ° Ø¯Ù‚ÙŠÙ‚Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙˆØ±ÙŠ

---

## ğŸ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©

### Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠÙ†:

| Ø§Ù„ÙØ¦Ø© | Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ | Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ | **Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ** |
|------|---------------|----------------|-------------------|
| **Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©** | 4.2/10 (D) | 4.2/10 | **4.2/10** ğŸ”´ |
| **Frontend** | 5.5/10 (D+) | 4.5/10 | **5.0/10** ğŸŸ¡ |
| **Backend** | 3.0/10 (F) | 3.8/10 | **3.4/10** ğŸ”´ |
| **Database** | 7.0/10 (B-) | 4.0/10 | **5.5/10** ğŸŸ¡ |
| **Security** | 2.5/10 (F) | 2.5/10 | **2.5/10** ğŸ”´ |
| **Scalability** | 6.0/10 (C) | 3.0/10 | **4.5/10** ğŸŸ¡ |
| **Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø¥Ù†ØªØ§Ø¬** | 1.0/10 (F) | N/A | **1.0/10** ğŸ”´ |

### ğŸ“Š Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ­Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸš¨ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: ØºÙŠØ± Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ù†ØªØ§Ø¬    â”‚
â”‚  ğŸ“ˆ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…: 4.2/10 (D)         â”‚
â”‚  âš ï¸  Ù…Ø´Ø§ÙƒÙ„ Ø­Ø±Ø¬Ø©: 10                   â”‚
â”‚  ğŸ”§ ÙˆÙ‚Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ù‚Ø¯Ø±: 4-6 Ø£Ø³Ø§Ø¨ÙŠØ¹   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”´ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø­Ø±Ø¬Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© - Top 10

ØªÙ… Ø¯Ù…Ø¬ ÙˆÙ…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ù…Ù† Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠÙ† ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:

### #1 ğŸš¨ BLOCKER: ÙˆØ¶Ø¹ Mock Mode Ø§Ù„Ù…ÙØ«Ø¨Øª
**Ù…ÙØ«Ø¨Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠÙ†** âœ…âœ…

**Ø§Ù„Ù…ÙˆÙ‚Ø¹:**
- `src/services/supabaseService.ts:6`
- `src/context/AuthContext.tsx:9`

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…ÙÙˆØ­Ø¯Ø©:**
```typescript
// supabaseService.ts - Line 6
export const IS_MOCK_MODE = true; // âŒ HARDCODED

// AuthContext.tsx - Line 9  
const IS_MOCK_MODE = process.env.NEXT_PUBLIC_IS_MOCK_MODE === 'true' || true;
// âŒ Always true fallback
```

**Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„:**
1. **Ø¥Ù†ØªØ§Ø¬:** Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ mock ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬
2. **Ø£Ù…Ø§Ù†:** Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† admins ÙÙŠ mock mode
3. **Ø¨ÙŠØ§Ù†Ø§Øª:** Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙˆÙ‡Ù…ÙŠØ©
4. **Ù…Ø§Ù„ÙŠ:** ØµÙØ± Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø§Ù„Ø¯ÙØ¹ Ù…ÙˆÙ‡ÙˆÙ…)

**Ø§Ù„Ø­Ù„ Ø§Ù„Ø¯Ù‚ÙŠÙ‚:**
```typescript
// Step 1: supabaseService.ts
export const IS_MOCK_MODE = 
  typeof window !== 'undefined'
    ? window.localStorage.getItem('DEV_MOCK_MODE') === 'true'
    : process.env.NEXT_PUBLIC_IS_MOCK_MODE === 'true';

// Step 2: AuthContext.tsx - Ø­Ø°Ù Ø§Ù„ÙØ§Ù„Ø¨Ø§Ùƒ
const IS_MOCK_MODE = process.env.NEXT_PUBLIC_IS_MOCK_MODE === 'true';
// âŒ Remove: || true

// Step 3: .env.production
NEXT_PUBLIC_IS_MOCK_MODE=false

// Step 4: .env.local (Ù„Ù„ØªØ·ÙˆÙŠØ±)
NEXT_PUBLIC_IS_MOCK_MODE=true
```

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** P0 - BLOCKER
**Ø§Ù„ÙˆÙ‚Øª:** 1 Ø³Ø§Ø¹Ø©
**Ø§Ù„ØªÙ†ÙÙŠØ°:** Ø§Ù„Ø¢Ù† - Ù‚Ø¨Ù„ Ø£ÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø±

---

### #2 ğŸ”’ CRITICAL: ØªØ®Ø²ÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù†ØµØ§Ù‹ ØµØ±ÙŠØ­Ø§Ù‹
**Ù…ÙØ«Ø¨Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ** âœ…

**Ø§Ù„Ù…ÙˆÙ‚Ø¹:**
- `src/context/AuthContext.tsx:86-87`

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// AuthContext.tsx
localStorage.setItem('gamasa_users', JSON.stringify([
  ...existingUsers,
  { 
    email, 
    password, // âŒ PLAINTEXT PASSWORD
    // ...
  }
]));
```

**Ø§Ù„ØªØ£Ø«ÙŠØ±:**
- Ø«ØºØ±Ø© Ø£Ù…Ù†ÙŠØ© Ø®Ø·ÙŠØ±Ø©
- Ø§Ù†ØªÙ‡Ø§Ùƒ Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø­Ù…Ø§ÙŠØ©
- Ù…Ø®Ø§Ù„ÙØ© Ù„Ù€ GDPR

**Ø§Ù„Ø­Ù„ Ø§Ù„Ø¯Ù‚ÙŠÙ‚:**
```typescript
// Step 1: Ø­Ø°Ù ØªØ®Ø²ÙŠÙ† localStorage Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
// âŒ DELETE: AuthContext.tsx localStorage logic

// Step 2: Ø§Ø³ØªØ®Ø¯Ø§Ù… Supabase Auth ÙÙ‚Ø·
import { supabase } from '@/lib/supabase/client';

const register = async (email: string, password: string, userData: any) => {
  const { data, error } = await supabase.auth.signUp({
    email,
    password, // âœ… Supabase ÙŠØ´ÙÙ‘Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    options: {
      data: {
        full_name: userData.fullName,
        phone: userData.phone,
        role: userData.role
      }
    }
  });
  
  if (error) throw error;
  return data;
};

// Step 3: Ø­Ø°Ù Ù…Ù„Ù storage.ts Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
// rm src/lib/storage.ts
```

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** P0 - CRITICAL
**Ø§Ù„ÙˆÙ‚Øª:** 6 Ø³Ø§Ø¹Ø§Øª (Ø­Ø°Ù + Ø¥Ø¹Ø§Ø¯Ø© ÙƒØªØ§Ø¨Ø©)
**Ø§Ù„ØªÙ†ÙÙŠØ°:** Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„

---

### #3 ğŸ’° CRITICAL: Race Condition ÙÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
**Ù…ÙØ«Ø¨Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠÙ†** âœ…âœ…

**Ø§Ù„Ù…ÙˆÙ‚Ø¹:**
- `src/services/supabaseService.ts:461-492` (toggleFavorite)
- `src/services/supabaseService.ts:528-531` (unlockProperty)
- `src/services/supabaseService.ts:1116-1137` (checkAvailability + createBooking)

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©:**
```typescript
// Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ù…ØªÙƒØ±Ø± ÙÙŠ 3 Ø£Ù…Ø§ÙƒÙ†:
async function criticalOperation() {
  // Step 1: Check
  const exists = await checkIfExists();
  
  // âš ï¸ RACE CONDITION HERE - another user can act between steps
  
  // Step 2: Act
  if (!exists) {
    await create();
  }
}
```

**Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„:**
```typescript
// User A at 10:00:00.000
const available = await checkAvailability('prop-1', '2026-03-01', '2026-03-05');
// Returns: true âœ…

// User B at 10:00:00.050  
const available = await checkAvailability('prop-1', '2026-03-01', '2026-03-05');
// Returns: true âœ… (Ù„Ù… ÙŠÙÙ†Ø´Ø£ Ø­Ø¬Ø² A Ø¨Ø¹Ø¯)

// User A at 10:00:00.100
await createBooking({ propertyId: 'prop-1', ... }); // âœ… Success

// User B at 10:00:00.150
await createBooking({ propertyId: 'prop-1', ... }); // âœ… Success
// ğŸ’¥ DOUBLE BOOKING!
```

**Ø§Ù„Ø­Ù„ Ø§Ù„Ø¯Ù‚ÙŠÙ‚ - Database Function:**

```sql
-- File: supabase/migrations/20260208000001_atomic_booking.sql

CREATE OR REPLACE FUNCTION create_booking_atomically(
  p_property_id UUID,
  p_guest_id UUID,
  p_start_date DATE,
  p_end_date DATE,
  p_rental_type TEXT,
  p_total_amount DECIMAL,
  p_booking_type TEXT
) RETURNS TABLE(booking_id UUID, success BOOLEAN, error_message TEXT) AS $$
DECLARE
  v_booking_id UUID;
  v_conflict_count INT;
BEGIN
  -- Lock the property's booking rows
  PERFORM id FROM bookings
  WHERE property_id = p_property_id
    AND status IN ('confirmed', 'pending')
  FOR UPDATE;
  
  -- Check for overlapping bookings with proper date logic
  SELECT COUNT(*) INTO v_conflict_count
  FROM bookings
  WHERE property_id = p_property_id
    AND status IN ('confirmed', 'pending')
    AND (
      -- New booking starts during existing booking
      (p_start_date >= start_date AND p_start_date < end_date)
      OR
      -- New booking ends during existing booking
      (p_end_date > start_date AND p_end_date <= end_date)
      OR
      -- New booking completely contains existing booking
      (p_start_date <= start_date AND p_end_date >= end_date)
    );
  
  IF v_conflict_count > 0 THEN
    RETURN QUERY SELECT NULL::UUID, FALSE, 'Ø§Ù„Ø¹Ù‚Ø§Ø± Ù…Ø­Ø¬ÙˆØ² ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©'::TEXT;
    RETURN;
  END IF;
  
  -- Validate dates
  IF p_end_date <= p_start_date THEN
    RETURN QUERY SELECT NULL::UUID, FALSE, 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©'::TEXT;
    RETURN;
  END IF;
  
  -- Validate property exists and is available
  IF NOT EXISTS (
    SELECT 1 FROM properties 
    WHERE id = p_property_id 
      AND status = 'available'
  ) THEN
    RETURN QUERY SELECT NULL::UUID, FALSE, 'Ø§Ù„Ø¹Ù‚Ø§Ø± ØºÙŠØ± Ù…ØªØ§Ø­ Ù„Ù„Ø­Ø¬Ø²'::TEXT;
    RETURN;
  END IF;
  
  -- Create the booking
  INSERT INTO bookings (
    property_id,
    guest_id,
    start_date,
    end_date,
    rental_type,
    total_amount,
    booking_type,
    status
  ) VALUES (
    p_property_id,
    p_guest_id,
    p_start_date,
    p_end_date,
    p_rental_type,
    p_total_amount,
    p_booking_type,
    'pending'
  ) RETURNING id INTO v_booking_id;
  
  RETURN QUERY SELECT v_booking_id, TRUE, NULL::TEXT;
END;
$$ LANGUAGE plpgsql;

-- Add index for performance
CREATE INDEX IF NOT EXISTS idx_bookings_property_date_overlap 
ON bookings (property_id, start_date, end_date)
WHERE status IN ('confirmed', 'pending');
```

**Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯:**
```typescript
// src/services/supabaseService.ts

async createBooking(bookingData: any): Promise<{ data: any; error: any }> {
  if (IS_MOCK_MODE) {
    // ... mock logic
  }

  try {
    const { data, error } = await supabase.rpc('create_booking_atomically', {
      p_property_id: bookingData.propertyId,
      p_guest_id: bookingData.guestId,
      p_start_date: bookingData.startDate,
      p_end_date: bookingData.endDate,
      p_rental_type: bookingData.rentalType,
      p_total_amount: bookingData.totalAmount,
      p_booking_type: bookingData.bookingType
    });

    if (error) throw error;
    
    // data is array with single row
    const result = data?.[0];
    
    if (!result?.success) {
      return {
        data: null,
        error: { message: result?.error_message || 'ÙØ´Ù„ Ø§Ù„Ø­Ø¬Ø²' }
      };
    }

    return {
      data: { id: result.booking_id },
      error: null
    };
  } catch (error: any) {
    return {
      data: null,
      error: { message: error.message }
    };
  }
}

// âŒ DELETE: checkAvailability function (included in atomic function)
```

**Ø§Ø®ØªØ¨Ø§Ø± Race Condition:**
```typescript
// tests/booking.race-condition.test.ts

describe('Booking Race Condition Prevention', () => {
  it('should prevent double booking with concurrent requests', async () => {
    const propertyId = 'test-property-1';
    const startDate = '2026-03-01';
    const endDate = '2026-03-05';
    
    // Simulate 2 concurrent booking requests
    const booking1 = createBooking({
      propertyId,
      guestId: 'user-1',
      startDate,
      endDate,
      // ...
    });
    
    const booking2 = createBooking({
      propertyId,
      guestId: 'user-2',
      startDate,
      endDate,
      // ...
    });
    
    // Run concurrently
    const results = await Promise.all([booking1, booking2]);
    
    // Only ONE should succeed
    const successes = results.filter(r => !r.error);
    expect(successes).toHaveLength(1);
    
    // Other should fail with clear message
    const failures = results.filter(r => r.error);
    expect(failures).toHaveLength(1);
    expect(failures[0].error.message).toContain('Ù…Ø­Ø¬ÙˆØ²');
  });
});
```

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** P0 - CRITICAL
**Ø§Ù„ÙˆÙ‚Øª:** 6 Ø³Ø§Ø¹Ø§Øª (SQL function + testing)
**Ø§Ù„ØªÙ†ÙÙŠØ°:** Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„

---

### #4 ğŸ’¸ CRITICAL: ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¯ÙØ¹ - unlockProperty
**Ù…ÙØ«Ø¨Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠÙ†** âœ…âœ…

**Ø§Ù„Ù…ÙˆÙ‚Ø¹:**
- `src/services/supabaseService.ts:528-536`

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
async unlockProperty(userId: string, propertyId: string): Promise<void> {
  if (IS_MOCK_MODE) {
    _mockUnlocked.add(propertyId);
    return; // âŒ No validation
  }

  await supabase
    .from('unlocked_properties')
    .insert({ user_id: userId, property_id: propertyId });
  // âŒ No payment verification!
  // âŒ No amount check!
  // âŒ Anyone can call this!
}
```

**Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„ÙŠ:**
```typescript
// User opens DevTools Console:
import { supabaseService } from '@/services/supabaseService';

// Unlock ANY property without paying:
await supabaseService.unlockProperty('my-user-id', 'any-property-id');
// âœ… Success - 50 EGP bypassed!
```

**Ø§Ù„Ø­Ù„ Ø§Ù„ÙƒØ§Ù…Ù„:**

```sql
-- Step 1: Add is_consumed column to payment_requests
ALTER TABLE payment_requests 
ADD COLUMN IF NOT EXISTS is_consumed BOOLEAN DEFAULT FALSE;

-- Add unique constraint
CREATE UNIQUE INDEX IF NOT EXISTS idx_payment_requests_property_user_active
ON payment_requests(property_id, user_id)
WHERE status = 'approved' AND is_consumed = FALSE;
```

```typescript
// Step 2: Secure unlockProperty function
async unlockProperty(userId: string, propertyId: string): Promise<void> {
  if (IS_MOCK_MODE) {
    _mockUnlocked.add(propertyId);
    return;
  }

  // 1. Verify payment exists and is approved
  const { data: payment, error: paymentError } = await supabase
    .from('payment_requests')
    .select('*')
    .eq('user_id', userId)
    .eq('property_id', propertyId)
    .eq('status', 'approved')
    .eq('is_consumed', false)
    .maybeSingle();

  if (paymentError) {
    throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯ÙØ¹');
  }

  if (!payment) {
    throw new Error('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙØ¹ Ù…Ø¹ØªÙ…Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø±');
  }

  // 2. Verify amount
  const UNLOCK_FEE = 50; // EGP
  if (payment.amount < UNLOCK_FEE) {
    throw new Error(`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ (${payment.amount} Ø¬Ù†ÙŠÙ‡) Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (${UNLOCK_FEE} Ø¬Ù†ÙŠÙ‡)`);
  }

  // 3. Check if already unlocked
  const { data: alreadyUnlocked } = await supabase
    .from('unlocked_properties')
    .select('id')
    .eq('user_id', userId)
    .eq('property_id', propertyId)
    .maybeSingle();

  if (alreadyUnlocked) {
    throw new Error('Ø§Ù„Ø¹Ù‚Ø§Ø± Ù…ÙØªÙˆØ­ Ø¨Ø§Ù„ÙØ¹Ù„');
  }

  // 4. Atomic operation: mark payment consumed + unlock property
  const { error: updateError } = await supabase.rpc('unlock_property_with_payment', {
    p_user_id: userId,
    p_property_id: propertyId,
    p_payment_id: payment.id
  });

  if (updateError) {
    throw new Error(`ÙØ´Ù„ ÙØªØ­ Ø§Ù„Ø¹Ù‚Ø§Ø±: ${updateError.message}`);
  }
}
```

```sql
-- Step 3: Database function for atomic unlock
CREATE OR REPLACE FUNCTION unlock_property_with_payment(
  p_user_id UUID,
  p_property_id UUID,
  p_payment_id UUID
) RETURNS VOID AS $$
BEGIN
  -- Update payment as consumed
  UPDATE payment_requests
  SET is_consumed = TRUE
  WHERE id = p_payment_id
    AND user_id = p_user_id
    AND property_id = p_property_id
    AND status = 'approved'
    AND is_consumed = FALSE;
  
  IF NOT FOUND THEN
    RAISE EXCEPTION 'Payment not found or already consumed';
  END IF;
  
  -- Insert unlock record
  INSERT INTO unlocked_properties (user_id, property_id)
  VALUES (p_user_id, p_property_id)
  ON CONFLICT (user_id, property_id) DO NOTHING;
  
EXCEPTION
  WHEN OTHERS THEN
    -- Rollback on any error
    RAISE;
END;
$$ LANGUAGE plpgsql;
```

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** P0 - CRITICAL
**Ø§Ù„ÙˆÙ‚Øª:** 4 Ø³Ø§Ø¹Ø§Øª
**Ø§Ù„ØªÙ†ÙÙŠØ°:** Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„

---

### #5 ğŸ”“ CRITICAL: SQL Injection
**Ù…ÙØ«Ø¨Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠÙ†** âœ…âœ…

**Ø§Ù„Ù…ÙˆÙ‚Ø¹:**
- `src/services/supabaseService.ts:1131`
- `src/services/messagingService.ts:38-42`

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// checkAvailability - Line 1131
.or(`start_date.lte.${endDate},end_date.gte.${startDate}`);
// âŒ String interpolation - SQL Injection risk
```

**Exploit Example:**
```typescript
const maliciousEndDate = "2024-01-01' OR '1'='1";
// Results in:
.or(`start_date.lte.2024-01-01' OR '1'='1,end_date.gte.2024-01-01`)
// âœ… Bypasses all checks!
```

**Ø§Ù„Ø­Ù„:**
```typescript
// âŒ BEFORE (Vulnerable):
const { data, error } = await supabase
  .from('bookings')
  .select('id')
  .eq('property_id', propertyId)
  .in('status', ['confirmed', 'pending'])
  .or(`start_date.lte.${endDate},end_date.gte.${startDate}`);

// âœ… AFTER (Safe):
const { data, error } = await supabase
  .from('bookings')
  .select('id')
  .eq('property_id', propertyId)
  .in('status', ['confirmed', 'pending'])
  .gte('end_date', startDate)
  .lte('start_date', endDate);
```

**Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª:**
```bash
# Find all potential SQL injection points
grep -n "\${" src/services/*.ts | grep -E "(\.or|\.filter|\.select)"
```

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** P0 - CRITICAL
**Ø§Ù„ÙˆÙ‚Øª:** 1 Ø³Ø§Ø¹Ø©
**Ø§Ù„ØªÙ†ÙÙŠØ°:** Ø§Ù„Ø¢Ù†

---

### #6 âš ï¸ HIGH: Ù…Ø´Ø§ÙƒÙ„ Client/Server Components
**Ù…ÙØ«Ø¨Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ** âœ…

**Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹:**
- `src/app/property/[id]/page.tsx:1` - Missing 'use client'
- `src/app/property/[id]/booking/page.tsx:1` - Uses hooks without 'use client'

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// src/app/property/[id]/page.tsx
// âŒ No 'use client' directive but uses client features
export default function PropertyPage({ params }) {
  const [selectedImage, setSelectedImage] = useState(0); // âŒ Hook in server component
  // ...
}
```

**Ø§Ù„ØªØ£Ø«ÙŠØ±:**
- Build errors
- Hydration errors
- Runtime crashes

**Ø§Ù„Ø­Ù„ Ø§Ù„ØµØ­ÙŠØ­ (Next.js 16 Pattern):**

```typescript
// src/app/property/[id]/page.tsx (Server Component)
import { supabaseService } from '@/services/supabaseService';
import { PropertyClient } from './client';
import { notFound } from 'next/navigation';

// Server Component - fetches data
export default async function PropertyPage({ 
  params 
}: { 
  params: { id: string } 
}) {
  const property = await supabaseService.getPropertyById(params.id);
  
  if (!property) {
    notFound();
  }

  // Generate metadata for SEO
  return <PropertyClient property={property} />;
}

// Generate metadata (server-side only)
export async function generateMetadata({ params }: { params: { id: string } }) {
  const property = await supabaseService.getPropertyById(params.id);
  
  if (!property) return {};

  return {
    title: property.title,
    description: property.description,
    openGraph: {
      images: property.images,
      title: property.title,
      description: property.description
    }
  };
}
```

```typescript
// src/app/property/[id]/client.tsx (Client Component)
'use client';

import { useState } from 'react';
import { PropertyGallery } from '@/components/PropertyGallery';
import { PropertyDetails } from '@/components/PropertyDetails';
import type { Property } from '@/types';

interface PropertyClientProps {
  property: Property;
}

export function PropertyClient({ property }: PropertyClientProps) {
  // âœ… Now hooks are allowed
  const [selectedImage, setSelectedImage] = useState(0);
  const [isFavorite, setIsFavorite] = useState(false);

  // All interactive logic here
  
  return (
    <div>
      <PropertyGallery 
        images={property.images}
        selectedIndex={selectedImage}
        onSelect={setSelectedImage}
      />
      <PropertyDetails 
        property={property}
        isFavorite={isFavorite}
        onToggleFavorite={() => setIsFavorite(!isFavorite)}
      />
    </div>
  );
}
```

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** P1 - HIGH
**Ø§Ù„ÙˆÙ‚Øª:** 4 Ø³Ø§Ø¹Ø§Øª (ØªØ­ÙˆÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©)
**Ø§Ù„ØªÙ†ÙÙŠØ°:** Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ

---

### #7 ğŸ“Š HIGH: Ø¹Ø¯Ù… ØªØ·Ø§Ø¨Ù‚ Schema Ù…Ø¹ Types
**Ù…ÙØ«Ø¨Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ** âœ…

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// schema.sql - Line 48
booking_type TEXT CHECK (booking_type IN ('day', 'week', 'month', 'season'))

// database.types.ts - Line 60
booking_type: 'ÙŠÙˆÙ…' | 'Ø£Ø³Ø¨ÙˆØ¹' | 'Ø´Ù‡Ø±' | 'Ù…ÙˆØ³Ù…'
```

**Ø§Ù„ØªØ£Ø«ÙŠØ±:**
- Runtime errors Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
- ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµØ­Ø©
- Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©

**Ø§Ù„Ø­Ù„:**

```sql
-- Option A: Schema ÙŠØ³ØªØ®Ø¯Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (Ù…ÙˆØµÙ‰ Ø¨Ù‡)
ALTER TABLE bookings 
DROP CONSTRAINT IF EXISTS bookings_booking_type_check;

ALTER TABLE bookings 
ADD CONSTRAINT bookings_booking_type_check 
CHECK (booking_type IN ('daily', 'weekly', 'monthly', 'seasonal'));

-- Same for other fields
ALTER TABLE properties
DROP CONSTRAINT IF EXISTS properties_category_check;

ALTER TABLE properties
ADD CONSTRAINT properties_category_check
CHECK (category IN ('apartment', 'villa', 'chalet', 'studio', 'office'));
```

```typescript
// database.types.ts - ØªØ­Ø¯ÙŠØ«
export type BookingType = 'daily' | 'weekly' | 'monthly' | 'seasonal';
export type PropertyCategory = 'apartment' | 'villa' | 'chalet' | 'studio' | 'office';
export type PropertyStatus = 'available' | 'unavailable' | 'pending' | 'rented';

// Mapping Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø¥Ø°Ø§ Ù„Ø²Ù…)
export const BOOKING_TYPE_LABELS: Record<BookingType, string> = {
  daily: 'ÙŠÙˆÙ…ÙŠ',
  weekly: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ',
  monthly: 'Ø´Ù‡Ø±ÙŠ',
  seasonal: 'Ù…ÙˆØ³Ù…ÙŠ'
};
```

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** P1 - HIGH
**Ø§Ù„ÙˆÙ‚Øª:** 2 Ø³Ø§Ø¹Ø§Øª
**Ø§Ù„ØªÙ†ÙÙŠØ°:** Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„

---

### #8 ğŸ” MEDIUM: ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ù…ÙÙ‚ÙˆØ¯
**Ù…ÙØ«Ø¨Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠÙ†** âœ…âœ…

**Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹:**
- Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± (Ø¨Ø¯ÙˆÙ† ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ÙˆØ¹/Ø§Ù„Ø­Ø¬Ù…)
- Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Ø¨Ø¯ÙˆÙ† sanitization)
- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (XSS risk)

**Ø§Ù„Ø­Ù„ Ø§Ù„Ø´Ø§Ù…Ù„:**

```typescript
// src/lib/validation.ts

import { z } from 'zod';

// File upload validation
export const IMAGE_VALIDATION = {
  ALLOWED_TYPES: ['image/jpeg', 'image/png', 'image/webp'],
  MAX_SIZE: 5 * 1024 * 1024, // 5MB
  MIN_DIMENSION: 400,
  MAX_DIMENSION: 4000
};

export async function validateImageFile(file: File): Promise<{
  valid: boolean;
  error?: string;
}> {
  // Type check
  if (!IMAGE_VALIDATION.ALLOWED_TYPES.includes(file.type)) {
    return {
      valid: false,
      error: 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. Ø§Ø³ØªØ®Ø¯Ù… JPEGØŒ PNGØŒ Ø£Ùˆ WebP'
    };
  }

  // Size check
  if (file.size > IMAGE_VALIDATION.MAX_SIZE) {
    return {
      valid: false,
      error: 'Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB)'
    };
  }

  // Dimension check
  try {
    const dimensions = await getImageDimensions(file);
    
    if (
      dimensions.width < IMAGE_VALIDATION.MIN_DIMENSION ||
      dimensions.height < IMAGE_VALIDATION.MIN_DIMENSION
    ) {
      return {
        valid: false,
        error: `Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØ±Ø© Ù…Ù†Ø®ÙØ¶Ø© (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ ${IMAGE_VALIDATION.MIN_DIMENSION}px)`
      };
    }
    
    if (
      dimensions.width > IMAGE_VALIDATION.MAX_DIMENSION ||
      dimensions.height > IMAGE_VALIDATION.MAX_DIMENSION
    ) {
      return {
        valid: false,
        error: `Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ ${IMAGE_VALIDATION.MAX_DIMENSION}px)`
      };
    }
  } catch (error) {
    return {
      valid: false,
      error: 'ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙˆØ±Ø©'
    };
  }

  return { valid: true };
}

function getImageDimensions(file: File): Promise<{ width: number; height: number }> {
  return new Promise((resolve, reject) => {
    const img = new Image();
    const url = URL.createObjectURL(file);
    
    img.onload = () => {
      URL.revokeObjectURL(url);
      resolve({ width: img.width, height: img.height });
    };
    
    img.onerror = () => {
      URL.revokeObjectURL(url);
      reject(new Error('Failed to load image'));
    };
    
    img.src = url;
  });
}

// Zod schemas for forms
export const registerSchema = z.object({
  email: z.string().email('Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­'),
  password: z.string().min(8, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'),
  fullName: z.string().min(3, 'Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'),
  phone: z.string().regex(/^01[0-9]{9}$/, 'Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ù…ØµØ±ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­')
});

export const propertySchema = z.object({
  title: z.string().min(10, 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹').max(100, 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹'),
  description: z.string().min(50, 'Ø§Ù„ÙˆØµÙ Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹'),
  price_per_day: z.number().min(1, 'Ø§Ù„Ø³Ø¹Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±'),
  bedrooms: z.number().min(0).max(20),
  bathrooms: z.number().min(0).max(10),
  area: z.number().min(10, 'Ø§Ù„Ù…Ø³Ø§Ø­Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 10 Ù…ØªØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
});

export const messageSchema = z.object({
  content: z.string()
    .min(1, 'Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±ØºØ©')
    .max(1000, 'Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹')
    .transform(sanitizeHtml) // XSS prevention
});

// HTML sanitization
function sanitizeHtml(html: string): string {
  return html
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;')
    .replace(/\//g, '&#x2F;');
}
```

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** P1 - HIGH
**Ø§Ù„ÙˆÙ‚Øª:** 6 Ø³Ø§Ø¹Ø§Øª
**Ø§Ù„ØªÙ†ÙÙŠØ°:** Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ

---

### #9 ğŸ”„ MEDIUM: Ù†Ø¸Ø§Ù…Ø§Ù† Ù…ØµØ§Ø¯Ù‚Ø© Ù…ØªÙ†Ø§ÙØ³Ø§Ù†
**Ù…ÙØ«Ø¨Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠÙ†** âœ…âœ…

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```
System A: AuthContext.tsx (localStorage)
  - Uses: storage.ts
  - Returns: User type
  - Used by: Header, ProtectedRoute
  
System B: useUser.ts hook (Supabase)
  - Uses: Supabase directly
  - Returns: AppUser type
  - Used by: Property pages, Booking
```

**Ø§Ù„ØªØ£Ø«ÙŠØ±:**
- State ØºÙŠØ± Ù…ØªØ³Ù‚
- ØªØ¹Ø§Ø±Ø¶ Types
- Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ù€ synchronization

**Ø§Ù„Ø­Ù„ (Ø¯Ù…Ø¬ ÙƒØ§Ù…Ù„):**

```typescript
// Step 1: Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
// âŒ DELETE: src/context/AuthContext.tsx
// âŒ DELETE: src/lib/storage.ts

// Step 2: Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø¸Ø§Ù… Ù…ÙˆØ­Ø¯
// src/hooks/useAuth.ts (Ø¬Ø¯ÙŠØ¯)
'use client';

import { useState, useEffect, useCallback } from 'react';
import { supabase } from '@/lib/supabase/client';
import type { User, Session } from '@supabase/supabase-js';

interface Profile {
  id: string;
  full_name: string;
  phone: string;
  avatar_url: string | null;
  role: 'Ù…Ø¤Ø¬Ø±' | 'Ù…Ø³ØªØ£Ø¬Ø±';
  is_admin: boolean;
  is_verified: boolean;
}

interface AuthState {
  user: User | null;
  profile: Profile | null;
  session: Session | null;
  loading: boolean;
}

export function useAuth() {
  const [state, setState] = useState<AuthState>({
    user: null,
    profile: null,
    session: null,
    loading: true
  });

  const refreshUser = useCallback(async () => {
    try {
      const { data: { session } } = await supabase.auth.getSession();
      
      if (!session) {
        setState({ user: null, profile: null, session: null, loading: false });
        return;
      }

      // Fetch profile
      const { data: profile } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', session.user.id)
        .single();

      setState({
        user: session.user,
        profile: profile || null,
        session,
        loading: false
      });
    } catch (error) {
      console.error('Error refreshing user:', error);
      setState({ user: null, profile: null, session: null, loading: false });
    }
  }, []);

  useEffect(() => {
    // Initial load
    refreshUser();

    // Listen to auth changes
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      async (event, session) => {
        if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {
          await refreshUser();
        } else if (event === 'SIGNED_OUT') {
          setState({ user: null, profile: null, session: null, loading: false });
        }
      }
    );

    return () => {
      subscription.unsubscribe();
    };
  }, [refreshUser]);

  const login = useCallback(async (email: string, password: string) => {
    const { error } = await supabase.auth.signInWithPassword({
      email,
      password
    });
    
    if (!error) {
      await refreshUser();
    }
    
    return !error;
  }, [refreshUser]);

  const register = useCallback(async (userData: {
    email: string;
    password: string;
    fullName: string;
    phone: string;
    role: 'Ù…Ø¤Ø¬Ø±' | 'Ù…Ø³ØªØ£Ø¬Ø±';
  }) => {
    const { error } = await supabase.auth.signUp({
      email: userData.email,
      password: userData.password,
      options: {
        data: {
          full_name: userData.fullName,
          phone: userData.phone,
          role: userData.role
        }
      }
    });
    
    if (!error) {
      await refreshUser();
    }
    
    return !error;
  }, [refreshUser]);

  const logout = useCallback(async () => {
    await supabase.auth.signOut();
    setState({ user: null, profile: null, session: null, loading: false });
  }, []);

  return {
    user: state.user,
    profile: state.profile,
    session: state.session,
    loading: state.loading,
    isAuthenticated: !!state.user,
    login,
    register,
    logout,
    refreshUser
  };
}
```

```typescript
// Step 3: ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
// Before:
import { useAuth } from '@/context/AuthContext'; // âŒ

// After:
import { useAuth } from '@/hooks/useAuth'; // âœ…
```

**Ù…Ù„ÙØ§Øª Ù„Ù„ØªØ­Ø¯ÙŠØ« (~15 Ù…Ù„Ù):**
- Header.tsx
- ProtectedRoute.tsx
- AdminGuard.tsx
- LoginForm.tsx
- SignUpForm.tsx
- PropertyCard.tsx
- BookingPage.tsx
- MessagesPage.tsx
- ... Ø¥Ù„Ø®

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** P1 - HIGH
**Ø§Ù„ÙˆÙ‚Øª:** 8 Ø³Ø§Ø¹Ø§Øª
**Ø§Ù„ØªÙ†ÙÙŠØ°:** Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ

---

### #10 ğŸ“ˆ MEDIUM: ÙÙ‡Ø§Ø±Ø³ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø©
**Ù…ÙØ«Ø¨Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ** âœ…

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```sql
-- Current: No indexes for critical queries
SELECT * FROM bookings 
WHERE property_id = ? AND status IN ('confirmed', 'pending');
-- âŒ Full table scan

SELECT * FROM properties 
WHERE owner_id = ? ORDER BY created_at DESC;
-- âŒ Full table scan

SELECT * FROM conversations 
WHERE buyer_id = ? OR owner_id = ?;
-- âŒ Full table scan
```

**Ø§Ù„Ø­Ù„:**

```sql
-- File: supabase/migrations/20260208000002_add_performance_indexes.sql

-- Property indexes
CREATE INDEX IF NOT EXISTS idx_properties_owner 
ON properties(owner_id);

CREATE INDEX IF NOT EXISTS idx_properties_status_category 
ON properties(status, category) 
WHERE status = 'available';

CREATE INDEX IF NOT EXISTS idx_properties_created 
ON properties(created_at DESC);

-- Booking indexes
CREATE INDEX IF NOT EXISTS idx_bookings_property_status 
ON bookings(property_id, status)
WHERE status IN ('confirmed', 'pending');

CREATE INDEX IF NOT EXISTS idx_bookings_guest 
ON bookings(guest_id, status);

CREATE INDEX IF NOT EXISTS idx_bookings_dates 
ON bookings(start_date, end_date);

-- Conversation indexes
CREATE INDEX IF NOT EXISTS idx_conversations_buyer 
ON conversations(buyer_id);

CREATE INDEX IF NOT EXISTS idx_conversations_owner 
ON conversations(owner_id);

CREATE INDEX IF NOT EXISTS idx_conversations_property 
ON conversations(property_id);

-- Message indexes
CREATE INDEX IF NOT EXISTS idx_messages_conversation_time 
ON messages(conversation_id, created_at DESC);

CREATE INDEX IF NOT EXISTS idx_messages_sender 
ON messages(sender_id);

-- Notification indexes
CREATE INDEX IF NOT EXISTS idx_notifications_user_read 
ON notifications(user_id, is_read, created_at DESC);

-- Payment indexes
CREATE INDEX IF NOT EXISTS idx_payment_requests_user_status 
ON payment_requests(user_id, status);

CREATE INDEX IF NOT EXISTS idx_payment_requests_property 
ON payment_requests(property_id);

-- Full-text search (for property search)
CREATE INDEX IF NOT EXISTS idx_properties_search 
ON properties USING GIN(to_tsvector('arabic', title || ' ' || description));

-- Analyze tables for query planner
ANALYZE properties;
ANALYZE bookings;
ANALYZE conversations;
ANALYZE messages;
```

**ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:**
- Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª: 10x Ø£Ø³Ø±Ø¹
- Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª: 15x Ø£Ø³Ø±Ø¹
- Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª: 8x Ø£Ø³Ø±Ø¹
- Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ: 20x Ø£Ø³Ø±Ø¹

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** P2 - MEDIUM
**Ø§Ù„ÙˆÙ‚Øª:** 2 Ø³Ø§Ø¹Ø§Øª
**Ø§Ù„ØªÙ†ÙÙŠØ°:** Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø«

---

## ğŸ“… Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…ÙˆØ­Ø¯Ø© ÙˆØ§Ù„Ø¯Ù‚ÙŠÙ‚Ø©

### ğŸ”´ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„: Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø­Ø±Ø¬Ø© (Survival Mode)

**Ø§Ù„Ù‡Ø¯Ù:** Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚ Ø§Ù„ØªÙŠ ØªÙ…Ù†Ø¹ Ø§Ù„Ù†Ø´Ø±
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:** 20 Ø³Ø§Ø¹Ø§Øª

#### Ø§Ù„ÙŠÙˆÙ… 1-2 (8 Ø³Ø§Ø¹Ø§Øª)

**Ø§Ù„Ù…Ù‡Ø§Ù…:**
1. âœ… **Ø¥ØµÙ„Ø§Ø­ IS_MOCK_MODE** (1 Ø³Ø§Ø¹Ø©)
   - [ ] ØªØ­Ø¯ÙŠØ« supabaseService.ts
   - [ ] ØªØ­Ø¯ÙŠØ« AuthContext.tsx
   - [ ] Ø¥Ø¹Ø¯Ø§Ø¯ .env.production
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ ÙƒÙ„Ø§ Ø§Ù„ÙˆØ¶Ø¹ÙŠÙ†

2. âœ… **Ø¥ØµÙ„Ø§Ø­ SQL Injection** (1 Ø³Ø§Ø¹Ø©)
   - [ ] Ø§Ø³ØªØ¨Ø¯Ø§Ù„ .or() Ø¨Ù€ .filter()
   - [ ] ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹ malicious inputs
   
3. âœ… **Ø¥ØµÙ„Ø§Ø­ Schema/Types mismatch** (2 Ø³Ø§Ø¹Ø§Øª)
   - [ ] ØªØ­Ø¯ÙŠØ« schema.sql
   - [ ] ØªØ­Ø¯ÙŠØ« database.types.ts
   - [ ] ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± CRUD operations

4. âœ… **Ø¨Ø¯Ø¡ Race Condition Fix** (4 Ø³Ø§Ø¹Ø§Øª)
   - [ ] ÙƒØªØ§Ø¨Ø© SQL function
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± Function ÙÙŠ Supabase
   - [ ] ØªØ­Ø¯ÙŠØ« createBooking ÙÙŠ Ø§Ù„ÙƒÙˆØ¯

#### Ø§Ù„ÙŠÙˆÙ… 3-4 (8 Ø³Ø§Ø¹Ø§Øª)

**Ø§Ù„Ù…Ù‡Ø§Ù…:**
5. âœ… **Ø¥ÙƒÙ…Ø§Ù„ Race Condition** (3 Ø³Ø§Ø¹Ø§Øª)
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± concurrent requests
   - [ ] Ø¥Ø¶Ø§ÙØ© error handling
   - [ ] ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ù„

6. âœ… **Ø¥ØµÙ„Ø§Ø­ unlockProperty** (4 Ø³Ø§Ø¹Ø§Øª)
   - [ ] Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ is_consumed
   - [ ] ÙƒØªØ§Ø¨Ø© unlock function
   - [ ] ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ¯
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± payment verification

7. âœ… **Ø¥ØµÙ„Ø§Ø­ Client/Server Components** (1 Ø³Ø§Ø¹Ø©)
   - [ ] ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª
   - [ ] Ø¥Ø¶Ø§ÙØ© 'use client' Ø£Ùˆ ØªÙ‚Ø³ÙŠÙ…
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± build

#### Ø§Ù„ÙŠÙˆÙ… 5 (4 Ø³Ø§Ø¹Ø§Øª)

**Ø§Ù„Ù…Ù‡Ø§Ù…:**
8. âœ… **Testing & Documentation**
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª
   - [ ] ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
   - [ ] Commit Ùˆ Push

**Deliverable:** Ù†Ø¸Ø§Ù… Ø®Ø§Ù„Ù Ù…Ù† Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©ØŒ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ staging

---

### ğŸŸ¡ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±

**Ø§Ù„Ù‡Ø¯Ù:** ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:** 24 Ø³Ø§Ø¹Ø§Øª

#### Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:

1. âœ… **Ø¯Ù…Ø¬ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©** (8 Ø³Ø§Ø¹Ø§Øª)
   - [ ] Ø¥Ù†Ø´Ø§Ø¡ useAuth Ù…ÙˆØ­Ø¯
   - [ ] Ø­Ø°Ù AuthContext Ùˆ storage.ts
   - [ ] ØªØ­Ø¯ÙŠØ« 15 Ù…Ù„Ù
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„

2. âœ… **Ø¥Ø¶Ø§ÙØ© Input Validation** (6 Ø³Ø§Ø¹Ø§Øª)
   - [ ] Ø¥Ù†Ø´Ø§Ø¡ validation schemas (Zod)
   - [ ] ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
   - [ ] Ø¥Ø¶Ø§ÙØ© file upload validation
   - [ ] XSS prevention

3. âœ… **Error Boundaries** (3 Ø³Ø§Ø¹Ø§Øª)
   - [ ] Ø¥Ù†Ø´Ø§Ø¡ ErrorBoundary component
   - [ ] Ø¥Ø¶Ø§ÙØ© ÙÙŠ layout
   - [ ] Ø¥Ø¶Ø§ÙØ© error pages
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± error scenarios

4. âœ… **Rate Limiting** (4 Ø³Ø§Ø¹Ø§Øª)
   - [ ] Ø¥Ù†Ø´Ø§Ø¡ rate limiter middleware
   - [ ] ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ API routes
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø¯ÙˆØ¯
   - [ ] Ø¥Ø¶Ø§ÙØ© headers

5. âœ… **Testing** (3 Ø³Ø§Ø¹Ø§Øª)
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„
   - [ ] Security audit
   - [ ] Documentation

**Deliverable:** Ù†Ø¸Ø§Ù… Ø¢Ù…Ù† Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ù…Ù„Ø©

---

### ğŸŸ¢ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø«: Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‡ÙŠÙƒÙ„Ø© ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†

**Ø§Ù„Ù‡Ø¯Ù:** ÙƒÙˆØ¯ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØµÙŠØ§Ù†Ø© ÙˆØ£Ø¯Ø§Ø¡ Ù…Ø­Ø³Ù‘Ù†
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:** 22 Ø³Ø§Ø¹Ø§Øª

#### Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:

1. âœ… **ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©** (6 Ø³Ø§Ø¹Ø§Øª)
   - [ ] ØªÙ‚Ø³ÙŠÙ… BookingPage (551 Ø³Ø·Ø±)
   - [ ] ØªÙ‚Ø³ÙŠÙ… PropertyCard
   - [ ] Ø§Ø³ØªØ®Ø±Ø§Ø¬ DateSelector logic

2. âœ… **Ø¯Ù…Ø¬ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©** (4 Ø³Ø§Ø¹Ø§Øª)
   - [ ] Ø¯Ù…Ø¬ Navbar + BottomNav
   - [ ] Ø¯Ù…Ø¬ MapView + PropertyMap
   - [ ] Ø¯Ù…Ø¬ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©

3. âœ… **Ø¥Ø¶Ø§ÙØ© Pagination** (4 Ø³Ø§Ø¹Ø§Øª)
   - [ ] ØªØ­Ø¯ÙŠØ« getProperties
   - [ ] Ø¥Ù†Ø´Ø§Ø¡ Pagination component
   - [ ] ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Search
   - [ ] ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ My Properties

4. âœ… **Database Indexes** (2 Ø³Ø§Ø¹Ø§Øª)
   - [ ] ØªØ·Ø¨ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ‡Ø§Ø±Ø³
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡
   - [ ] ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª

5. âœ… **Cleanup** (6 Ø³Ø§Ø¹Ø§Øª)
   - [ ] Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
   - [ ] ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒÙˆØ¯
   - [ ] ØªØ­Ø¯ÙŠØ« Documentation
   - [ ] Code review

**Deliverable:** ÙƒÙˆØ¯ Ù…Ù†Ø¸Ù… ÙˆØ³Ø±ÙŠØ¹

---

### ğŸ”µ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„Ø¥Ù†ØªØ§Ø¬ ÙˆØ§Ù„Ù†Ø´Ø±

**Ø§Ù„Ù‡Ø¯Ù:** Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù†Ø´Ø±
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:** 20 Ø³Ø§Ø¹Ø§Øª

#### Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:

1. âœ… **Server Components Migration** (8 Ø³Ø§Ø¹Ø§Øª)
   - [ ] ØªØ­ÙˆÙŠÙ„ Home page
   - [ ] ØªØ­ÙˆÙŠÙ„ Search page
   - [ ] ØªØ­ÙˆÙŠÙ„ Property details
   - [ ] Ø§Ø®ØªØ¨Ø§Ø± SEO

2. âœ… **Performance Optimization** (6 Ø³Ø§Ø¹Ø§Øª)
   - [ ] React.memo Ù„Ù„Ù…ÙƒÙˆÙ†Ø§Øª
   - [ ] Image optimization
   - [ ] Code splitting
   - [ ] Lazy loading

3. âœ… **Final Testing** (4 Ø³Ø§Ø¹Ø§Øª)
   - [ ] E2E tests
   - [ ] Load testing
   - [ ] Security audit final
   - [ ] Mobile testing

4. âœ… **Deployment Prep** (2 Ø³Ø§Ø¹Ø§Øª)
   - [ ] Environment setup
   - [ ] CI/CD pipeline
   - [ ] Monitoring setup
   - [ ] Backup strategy

**Deliverable:** Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ù†ØªØ§Ø¬ 100%

---

## ğŸ“Š Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ù†Ø¬Ø§Ø­

### Technical KPIs

```
âœ… Security Score: 2.5/10 â†’ 9.0/10
âœ… Performance: <5s â†’ <2s (page load)
âœ… Code Quality: 4.2/10 â†’ 8.0/10
âœ… Test Coverage: 0% â†’ 80%+
âœ… Build Errors: Multiple â†’ Zero
âœ… Console Warnings: 50+ â†’ Zero
```

### Business KPIs

```
âœ… Booking Success Rate: Unknown â†’ >95%
âœ… Payment Success Rate: 0% (mock) â†’ >90%
âœ… User Registration: Unknown â†’ >80% completion
âœ… System Uptime: N/A â†’ >99.5%
```

---

## âœ… Checklist Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±

### ğŸ”’ Security

- [ ] IS_MOCK_MODE = false ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬
- [ ] Ø¬Ù…ÙŠØ¹ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù…ÙØ´ÙØ±Ø© (Supabase Auth)
- [ ] Ù„Ø§ ÙŠÙˆØ¬Ø¯ SQL injection vulnerabilities
- [ ] Rate limiting Ù…ÙÙØ¹Ù‘Ù„
- [ ] File upload validation Ù…ÙØ·Ø¨Ù‚
- [ ] XSS protection Ù…ÙˆØ¬ÙˆØ¯
- [ ] RLS policies Ù…ÙØ®ØªØ¨Ø±Ø©
- [ ] Session management Ø¢Ù…Ù†

### âš¡ Performance

- [ ] Ø¬Ù…ÙŠØ¹ Database indexes Ù…ÙØ·Ø¨Ù‚Ø©
- [ ] Server Components Ù„Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
- [ ] Images optimized (WebP, sizes, lazy load)
- [ ] Pagination Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
- [ ] React.memo Ù„Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø«Ù‚ÙŠÙ„Ø©
- [ ] Code splitting Ù…ÙÙØ¹Ù‘Ù„
- [ ] Bundle size < 500KB (initial)
- [ ] LCP < 2.5s, FID < 100ms, CLS < 0.1

### ğŸ›¡ï¸ Reliability

- [ ] Error boundaries ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª
- [ ] Loading states ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª async
- [ ] Error messages ÙˆØ§Ø¶Ø­Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
- [ ] Retry logic Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©
- [ ] Offline support (PWA)
- [ ] Backup procedures Ù…ÙˆØ«Ù‚Ø©

### ğŸ¯ Functionality

- [ ] ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙŠØ¹Ù…Ù„
- [ ] Booking flow ÙƒØ§Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡
- [ ] Payment verification ÙŠØ¹Ù…Ù„
- [ ] Unlocking properties ÙŠØ¹Ù…Ù„
- [ ] Messaging system ÙŠØ¹Ù…Ù„
- [ ] Admin dashboard ÙŠØ¹Ù…Ù„
- [ ] Mobile responsive 100%

### ğŸ“± Mobile

- [ ] PWA installable
- [ ] Touch gestures ØªØ¹Ù…Ù„
- [ ] Navigation Ø³Ù‡Ù„
- [ ] Forms usable on mobile
- [ ] Images load fast on 3G

### ğŸ“ˆ Monitoring

- [ ] Error tracking (Sentry Ø£Ùˆ Ù…Ø´Ø§Ø¨Ù‡)
- [ ] Performance monitoring
- [ ] Analytics setup
- [ ] Logging system
- [ ] Alerts configured

---

## ğŸš€ Ø®Ø·Ø© Ø§Ù„Ù†Ø´Ø±

### Pre-launch (ÙŠÙˆÙ… -1)

1. **Final Testing**
   - [ ] Smoke tests
   - [ ] User acceptance testing
   - [ ] Load testing
   
2. **Backups**
   - [ ] Database backup
   - [ ] Code backup
   - [ ] Environment configs backup

3. **Monitoring Setup**
   - [ ] Error tracking live
   - [ ] Performance dashboard
   - [ ] Alerts configured

### Launch Day (ÙŠÙˆÙ… 0)

1. **Deploy to Production** (Morning)
   - [ ] Deploy code
   - [ ] Run migrations
   - [ ] Verify all services

2. **Monitor** (All day)
   - [ ] Watch error rates
   - [ ] Monitor performance
   - [ ] Check user feedback

3. **Hotfix Ready**
   - [ ] Team on standby
   - [ ] Rollback plan ready

### Post-launch (ÙŠÙˆÙ… +1 to +7)

1. **Monitor Metrics**
   - [ ] Daily error reports
   - [ ] Performance trends
   - [ ] User behavior analytics

2. **Collect Feedback**
   - [ ] User surveys
   - [ ] Support tickets
   - [ ] Feature requests

3. **Quick Iterations**
   - [ ] Fix critical bugs
   - [ ] UX improvements
   - [ ] Performance tweaks

---

## ğŸ“ Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©

### Team Structure

```
ğŸ‘¨â€ğŸ’¼ Project Manager
  â”œâ”€â”€ ğŸ‘¨â€ğŸ’» Lead Developer (Full-stack)
  â”œâ”€â”€ ğŸ‘¨â€ğŸ’» Frontend Developer
  â”œâ”€â”€ ğŸ‘¨â€ğŸ’» Backend Developer
  â””â”€â”€ ğŸ‘¨â€ğŸ”¬ QA Engineer
```

### Communication Plan

- **Daily Standups:** 15 min, 10:00 AM
- **Weekly Reviews:** 1 hour, Monday
- **Sprint Planning:** 2 hours, start of week
- **Retrospectives:** 1 hour, end of sprint

### Issue Escalation

```
Level 1: Developer (1-4 hours)
  â†“
Level 2: Lead Developer (4-24 hours)
  â†“
Level 3: Project Manager (24+ hours)
```

---

## ğŸ“š Resources

### Documentation

- **Technical Docs:** `/docs/technical/`
- **API Docs:** `/docs/api/`
- **Database Schema:** `/docs/database/`
- **Deployment Guide:** `/docs/deployment/`

### Tools

- **Project Management:** Jira / Trello
- **Version Control:** Git / GitHub
- **CI/CD:** GitHub Actions / Vercel
- **Monitoring:** Vercel Analytics + Sentry
- **Database:** Supabase Dashboard

---

## ğŸ¯ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©

Ø¨Ø¹Ø¯ 4 Ø£Ø³Ø§Ø¨ÙŠØ¹ Ù…Ù† Ø§Ù„ØªÙ†ÙÙŠØ°:

âœ… **Ù†Ø¸Ø§Ù… Ø¢Ù…Ù†** Ø¨Ø¯ÙˆÙ† Ø«ØºØ±Ø§Øª Ø­Ø±Ø¬Ø©
âœ… **Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²** (<2s load time)
âœ… **ÙƒÙˆØ¯ Ù†Ø¸ÙŠÙ** ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„ØµÙŠØ§Ù†Ø©
âœ… **ØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªØ®Ø¯Ù…** Ø³Ù„Ø³Ø©
âœ… **Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ù†ØªØ§Ø¬** 100%
âœ… **Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙˆØ³Ø¹** Ù„Ø¢Ù„Ø§Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†

---

## âš ï¸ ØªØ­Ø°ÙŠØ±Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ©

### ğŸš« Ù„Ø§ ØªÙØ¹Ù„:

1. âŒ Ù†Ø´Ø± Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø¥Ù†ØªØ§Ø¬ (Ø«ØºØ±Ø§Øª Ø­Ø±Ø¬Ø©)
2. âŒ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø£Ù…Ù†ÙŠØ© (P0)
3. âŒ Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª
4. âŒ ØªØ®Ø·ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
5. âŒ Ø§Ù„Ù†Ø´Ø± Ø¨Ø¯ÙˆÙ† backup

### âœ… Ø§ÙØ¹Ù„:

1. âœ… Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„ ÙÙˆØ±Ø§Ù‹
2. âœ… Ø§Ø®ØªØ¨Ø± ÙƒÙ„ Ø¥ØµÙ„Ø§Ø­ Ø¬ÙŠØ¯Ø§Ù‹
3. âœ… ÙˆØ«Ù‘Ù‚ ÙƒÙ„ ØªØºÙŠÙŠØ±
4. âœ… Ø§Ø·Ù„Ø¨ code reviews
5. âœ… Ø§Ø³ØªØ®Ø¯Ù… staging Ù‚Ø¨Ù„ production

---

**ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:** ÙØ¨Ø±Ø§ÙŠØ± 8ØŒ 2026
**Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** 1.0 (Unified Analysis)
**Ø§Ù„Ø­Ø§Ù„Ø©:** Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ†ÙÙŠØ°

**Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:**
- âœ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„: Ù…Ø±Ø§Ø¬Ø¹ ØªÙ‚Ù†ÙŠ senior
- âœ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ: OpenCode.ai
- âœ… Ø§Ù„Ø¯Ù…Ø¬: Claude (Anthropic)
